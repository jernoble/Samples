---
title: "MSE Sync Test"
tags: Video MSE
---
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>synctest</title>
	<script src="media-source-loader.js"></script>
	<script>
    function waitFor(object, event) {
    	return new Promise(resolve => {
    		object.addEventListener(event, resolve, { once: true });
    	});
    }

	window.addEventListener('load', async event => {
        let video = document.createElement('video');
        document.body.appendChild(video);
        video.controls = true;
        video.playsInline = true;

        mediaSource = new MediaSource();
        video.srcObject = mediaSource;
        await waitFor(mediaSource, 'sourceopen');

        let loader = new MediaSourceLoader('../../common_assets/media/bipbop-10m-manifest.json', '../../common_assets/media/');
        await loader.load();
        let sourceBuffer = mediaSource.addSourceBuffer(loader.type);
        sourceBuffer.appendBuffer(loader.initSegment);
        await waitFor(sourceBuffer, 'update');

        for (var i = 0; i < loader.mediaSegmentsLength; ++i) {
	        sourceBuffer.appendBuffer(loader.mediaSegment(i));
	        await waitFor(sourceBuffer, 'update');
        }
	});
	</script>
</head>
<body>

</body>
</html>